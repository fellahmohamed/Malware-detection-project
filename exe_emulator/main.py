import sys
import os
import json
from speakeasy import Speakeasy

def generate_report(file_path):
    se = Speakeasy()

    # Load the binary into speakeasy
    with open(file_path, 'rb') as f:
        data = f.read()

    module = se.load_module(data=data)
    se.run_module(module)

    # Get a report of the emulation
    report = se.get_report()

    # Create a JSON file with the same name in the same directory
    report_file_path = os.path.join(os.path.dirname(file_path), f"{os.path.basename(file_path)}.json")
    with open(report_file_path, 'w') as f:
        json.dump(report, f)

    return report

if __name__ == "__main__":
    file_path = "simple_pe_feature_extractor/example.exe"
    report = generate_report(file_path)
    print("Report generated!")