import React, { useState } from 'react';
import axios from 'axios';  // Import axios for making HTTP requests
import '../../style/sectionsCss/Section3.css';
import uploadImg from '../../images/image 1.png';

const Section3 = () => {
  const [file, setFile] = useState(null);
  const [analysisResults, setAnalysisResults] = useState(null);

  const handleFileUpload = async (event) => {
    const uploadedFile = event.target.files[0];
    if (uploadedFile) {
      setFile(uploadedFile);
      await uploadFileToServer(uploadedFile);
    }
  };

  const uploadFileToServer = async (file) => {
    const formData = new FormData();
    formData.append('file', file);

    try {
      const response = await axios.post('http://localhost:8000/predict', formData, {
        headers: {
          'Content-Type': 'multipart/form-data'
        }
      });
      setAnalysisResults(response.data);
    } catch (error) {
      console.error('Error uploading file:', error);
    }
  };

  return (
    <section className="section3">
      <h2>Mal-detect</h2>
      <p>Upload your file to our website for a comprehensive analysis to detect and identify any potential malware threats, ensuring your data stays safe and secure.</p>
      <div className='inp'>
        <input 
          type="file" 
          id="file-upload" 
          className="file-upload" 
          onChange={handleFileUpload}
        />
        <label htmlFor="file-upload" className="file-upload-label">
          <img src={uploadImg} alt="Upload" />
        </label>
      </div>
      {file && (
        <div className="file-details">
          <p>File name: {file.name}</p>
          <p>Size: {(file.size / 1024).toFixed(2)} KB</p>
          <p>Type: {file.type}</p>
        </div>
      )}
      {analysisResults && (
        <div className="analysis-results">
          <div className="result-row">
            <span>Model XGBoost:</span>
            <span className={analysisResults.xgboost === 'malware' ? 'malware' : 'clean'}>
              {analysisResults.xgboost === 'malware' ? 'Malware ❌' : 'Clean ✔️'}
            </span>
            <a href="#">View details</a>
          </div>
          <div className="result-row">
            <span>Model CNN:</span>
            <span className={analysisResults.cnn === 'malware' ? 'malware' : 'clean'}>
              {analysisResults.cnn === 'malware' ? 'Malware ❌' : 'Clean ✔️'}
            </span>
            <a href="#">View details</a>
          </div>
          <div className="result-row">
            <span>Model MLP:</span>
            <span className={analysisResults.mlp === 'malware' ? 'malware' : 'clean'}>
              {analysisResults.mlp === 'malware' ? 'Malware ❌' : 'Clean ✔️'}
            </span>
            <a href="#">View details</a>
          </div>
        </div>
      )}
    </section>
  );
};

export default Section3;
